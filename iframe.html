<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const isFullscreen = urlParams.get('fullscreen') === 'true';
    const isShorts = urlParams.get('isShorts') === 'true';

    let containerStyle = '';
    if (isFullscreen) {
      containerStyle =
        'position: fixed; top: 0; left: 0; width: 100%; height: 100%; padding-bottom: 0;';
    }
  </script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .container {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 56.25%;
    }

    .video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .container.shorts {
      padding-bottom: 177.78%;
    }
  </style>
</head>

<body>
  <div id="video-container">
    <div class="container" id="container">
      <div class="video" id="player"></div>
    </div>
  </div>

  <script>
    try {
      // ... (URL parsing and data extraction code remains unchanged)

      function sendMessageToRN(msg) {
        if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
          window.ReactNativeWebView.postMessage(JSON.stringify(msg));
        }
      }

      // ... (viewport meta tag update code remains unchanged)

      var tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;
      function onYouTubeIframeAPIReady() {
        const containerElement = document.querySelector('.container');
        const containerWidth = containerElement.clientWidth;
        const containerHeight = containerElement.clientHeight;

        const playerId = 'player' + Date.now();

        player = new YT.Player(playerId, {
          width: containerWidth,
          height: containerHeight,
          videoId: videoId_s,
          playerVars: {
            end: end,
            rel: rel_s,
            list: list,
            color: color,
            loop: loop_s,
            start: start,
            playsinline: 1,
            hl: playerLang,
            playlist: playlist,
            listType: listType,
            controls: controls_s,
            fs: preventFullScreen_s,
            cc_lang_pref: cc_lang_pref_s,
            iv_load_policy: iv_load_policy,
            modestbranding: modestbranding_s,
            cc_load_policy: showClosedCaptions_s,
          },
          events: {
            onReady: onPlayerReady,
            onError: onPlayerError,
            onStateChange: onPlayerStateChange,
            onPlaybackRateChange: onPlaybackRateChange,
            onPlaybackQualityChange: onPlaybackQualityChange,
          },
        });
      }

      function onPlayerError(event) {
        let errorMessage = 'An error occurred';
        // ... (error handling code remains unchanged)
        sendMessageToRN({ eventType: 'playerError', data: event.data, message: errorMessage });
      }

      function onPlaybackRateChange(event) {
        sendMessageToRN({ eventType: 'playbackRateChange', data: event.data });
      }

      function onPlaybackQualityChange(event) {
        sendMessageToRN({ eventType: 'playerQualityChange', data: event.data });
      }

      function onPlayerReady(event) {
        sendMessageToRN({ eventType: 'playerReady' });
      }

      function onPlayerStateChange(event) {
        sendMessageToRN({ eventType: 'playerStateChange', data: event.data });
      }

      var isFullScreen = false;
      function onFullScreenChange() {
        // ... (fullscreen detection code remains unchanged)
        sendMessageToRN({
          eventType: 'fullScreenChange',
          data: Boolean(isFullScreen),
        });
      }

      document.addEventListener('fullscreenchange', onFullScreenChange);
      document.addEventListener('msfullscreenchange', onFullScreenChange);
      document.addEventListener('mozfullscreenchange', onFullScreenChange);
      document.addEventListener('webkitfullscreenchange', onFullScreenChange);

      window.addEventListener('message', function (event) {
        const { data } = event;

        try {
          const parsedData = JSON.parse(data);
          const { eventName, meta } = parsedData;

          switch (eventName) {
            case 'playVideo':
              player.playVideo();
              break;

            case 'pauseVideo':
              player.pauseVideo();
              break;

            case 'muteVideo':
              player.mute();
              break;

            case 'unMuteVideo':
              player.unMute();
              break;

            case 'setVolume':
              player.setVolume(meta.volume);
              break;

            case 'setPlaybackRate':
              player.setPlaybackRate(meta.playbackRate);
              break;
          }
        } catch (error) {
          console.error('Error parsing data', event, error);
        }
      });
    } catch (error) {
      console.error('Detailed error:', error);
    }
  </script>
</body>

</html>
